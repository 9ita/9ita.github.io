**Zookeeper**는 분산 시스템을 위한 **코디네이션 서비스**로, 분산 애플리케이션 간에 중요한 정보를 공유하고, 동기화 및 관리하는 데 사용됩니다. Zookeeper는 **Apache Hadoop** 생태계의 일부로 시작되었지만, 이후 다양한 분산 시스템에서 중요한 역할을 하고 있습니다. 주로 **분산 시스템의 안정성과 일관성을 유지**하는 데 중요한 역할을 하며, 리더 선출, 설정 관리, 서비스 등록, 분산 잠금 등의 기능을 제공합니다.

### Zookeeper의 핵심 개념

1. **ZNode (ZooKeeper Node)**:
   - Zookeeper는 데이터를 **ZNode**라는 경로 기반 트리 구조로 관리합니다. 각 ZNode는 파일 시스템의 디렉터리처럼 동작하며, 데이터를 저장할 수 있고, 하위 노드를 가질 수 있습니다.
   - 각 ZNode는 데이터를 저장하거나 자식 노드를 가지며, **Persistent ZNode**와 **Ephemeral ZNode**로 구분됩니다.
     - **Persistent ZNode**: 클라이언트가 연결을 끊더라도 사라지지 않고 유지됩니다.
     - **Ephemeral ZNode**: 클라이언트가 연결을 끊으면 자동으로 삭제됩니다.

2. **클라이언트와 서버 모델**:
   - Zookeeper는 클라이언트-서버 모델을 기반으로 작동합니다. 클라이언트는 Zookeeper 서버와 연결되어 메타데이터를 읽고, 기록하고, 감시(watch)할 수 있습니다.

3. **Watchers (감시자)**:
   - Zookeeper는 **감시자** 기능을 제공하여 ZNode의 상태나 데이터가 변경될 때 이를 클라이언트에 알려줍니다. 이를 통해 클라이언트는 데이터가 변경되었을 때 이를 감지하고 적절하게 처리할 수 있습니다.

4. **리더 선출 (Leader Election)**:
   - Zookeeper는 클러스터 내에서 리더를 선출하는 기능을 제공합니다. 분산 시스템에서 여러 노드 중 하나를 리더로 선출하여 작업을 조정할 수 있으며, Zookeeper는 이를 위한 안정적인 메커니즘을 제공합니다.

5. **분산 락 (Distributed Lock)**:
   - 분산 시스템에서 동기화된 작업이 필요할 때 Zookeeper는 **분산 락**을 구현하는 데 사용됩니다. 여러 프로세스가 동일한 리소스에 접근할 때, Zookeeper는 해당 리소스를 잠그고, 다른 프로세스가 접근하지 못하도록 합니다.

### Zookeeper의 주요 사용 사례

1. **리더 선출 (Leader Election)**:
   - 분산 시스템에서 리더 노드를 선출하는 작업은 매우 중요합니다. 여러 서버 중 하나를 리더로 뽑아 특정 작업을 전담하게 하는 경우, Zookeeper는 선출 프로세스를 관리하여 고가용성을 보장합니다.
   - **예시**: Apache Kafka는 여러 브로커 중에서 리더를 선출할 때 Zookeeper를 사용합니다. 리더는 파티션의 데이터를 관리하고, 다른 브로커들이 리더의 지시에 따라 동작하게 됩니다.

2. **분산 구성 관리 (Distributed Configuration Management)**:
   - 분산 시스템에서 여러 인스턴스가 동일한 설정 정보를 공유해야 하는 경우, Zookeeper는 이러한 설정 정보를 중앙에서 관리할 수 있습니다. Zookeeper에 저장된 설정 정보가 변경되면, 감시자(watch)를 통해 모든 인스턴스가 즉시 이를 감지하고 설정을 업데이트할 수 있습니다.
   - **예시**: 대규모 클러스터 시스템에서 애플리케이션 구성 정보(예: 데이터베이스 연결 정보, 서비스 엔드포인트)를 Zookeeper에 저장하고 관리할 수 있습니다.

3. **분산 락 서비스 (Distributed Lock Service)**:
   - 여러 노드에서 특정 리소스를 동시에 사용하지 못하게 하거나 순차적으로 접근해야 할 때 Zookeeper를 활용하여 **분산 잠금 메커니즘**을 구현할 수 있습니다.
   - **예시**: 여러 인스턴스가 동일한 자원에 접근할 때, Zookeeper를 통해 해당 자원을 잠그고 하나의 인스턴스만 접근하도록 제어할 수 있습니다.

4. **서비스 디스커버리 (Service Discovery)**:
   - Zookeeper는 분산된 서비스의 위치와 상태를 관리하는 데 활용됩니다. 서비스가 추가되거나 제거될 때 Zookeeper에 이를 반영하고, 다른 서비스가 해당 정보를 조회하여 동적으로 연결할 수 있습니다.
   - **예시**: 분산 마이크로서비스 환경에서, 새로운 서비스가 시작되면 Zookeeper에 해당 서비스의 IP와 포트를 등록하고, 다른 서비스가 이를 이용하여 동적으로 해당 서비스에 연결합니다.

5. **분산 큐 (Distributed Queue)**:
   - Zookeeper를 활용해 **분산 큐**를 구현할 수 있습니다. 여러 클라이언트가 큐에 데이터를 추가하거나 꺼낼 때, Zookeeper는 이를 관리하고 동기화된 접근을 보장합니다.
   - **예시**: 작업을 여러 프로세스에 분배할 때, 작업 큐를 Zookeeper를 통해 관리하여 중복 작업을 방지하고 일관된 처리 순서를 유지할 수 있습니다.

### Zookeeper를 사용하는 주요 분산 시스템

1. **Apache Kafka**:
   - Kafka는 Zookeeper를 사용하여 **브로커 간의 메타데이터 관리** 및 **파티션 리더 선출**을 관리합니다. Zookeeper는 Kafka 클러스터의 상태를 관리하고, 브로커 간의 동기화 및 장애 복구에 중요한 역할을 합니다.
   
2. **Hadoop**:
   - Hadoop 에코시스템에서 Zookeeper는 **리소스 관리자**와 **노드 관리자** 간의 통신을 조율하고, 클러스터의 상태를 모니터링하는 데 사용됩니다.

3. **Apache HBase**:
   - HBase는 Zookeeper를 통해 **메타데이터 관리** 및 **리전 서버 간의 동기화**를 처리합니다. Zookeeper를 통해 서버가 장애 발생 시 빠르게 복구되도록 보장합니다.

### Zookeeper의 장점

1. **간단한 API**: Zookeeper는 간단한 API를 제공하여 노드 생성, 업데이트, 삭제 및 감시 기능을 쉽게 사용할 수 있습니다.
   
2. **일관성 보장**: Zookeeper는 트랜잭션을 기반으로 하여 일관된 데이터를 보장하며, 다수의 노드 간에 동기화된 상태를 유지할 수 있습니다.

3. **고가용성**: 여러 개의 Zookeeper 서버가 클러스터로 구성되어, 서버 중 하나가 장애가 나더라도 시스템이 중단되지 않고 계속 운영될 수 있습니다.

### Zookeeper의 단점

1. **쓰기 성능 제한**: Zookeeper는 일관성을 보장하기 위해 **쓰기 성능**이 제한될 수 있으며, 대규모 데이터 쓰기가 필요한 환경에서는 성능 저하가 발생할 수 있습니다.
   
2. **단일 장애점**: Zookeeper 자체가 클러스터에서 장애가 발생할 경우, 이를 사용하는 애플리케이션에 영향을 미칠 수 있습니다. 따라서 Zookeeper 클러스터가 제대로 구성되어야 합니다.

### 결론

Zookeeper는 분산 시스템에서 다양한 코디네이션 작업을 수행하는 데 필수적인 도구입니다. 이를 통해 리더 선출, 서비스 디스커버리, 분산 락 관리, 분산 큐 구현 등 많은 중요한 기능을 제공하며, Kafka, Hadoop, HBase와 같은 대규모 시스템에서도 널리 사용되고 있습니다. Zookeeper는 이러한 분산 시스템에서 안정적이고 일관된 상태를 유지하는 데 중요한 역할을 합니다.
